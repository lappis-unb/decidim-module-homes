<div class="card">
  <div class="card-divider">
    <h2 class="card-title toggle-settings">
      Componente Pagina Inicial
      <button type="button" class="dropdown tiny button button--title" data-toggle="add-component-dropdown"><%= t "components.index.add", scope: "decidim.admin" %></button>
      <div class="dropdown-pane" id="add-component-dropdown" data-dropdown data-auto-focus="true" data-close-on-click="true">
        <ul>
          <% initial_page_components.each do |element| %>
            <li><%= link_to t("#{element.name}.name", scope: "decidim.components"), new_home_element_path(type: element.name), class: element.name %></li>
          <% end %>
        </ul>
      </div>
    </h2>
  </div>
  <div class="cell small-6">
    <div class="card">
      <div class="card-section">
        <p class="mb-m">sdasdasddsa</p>
        <ul class="draggable-list js-connect js-list-availables">
          <% @home.home_elements.each do |element| %>
            <%= render partial: "decidim/homes/admin/homes_elements/initial_page_elements", locals: { element: element } %>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
  <div class="card-divider">
    <h2 class="card-title toggle-settings">
      Ordens
    </h2>
  </div>
  <div class="card-section">
    <p>Ordem dos componentes</p>
    <input id="field_orders" name="home[field_orders]" class="home-fields" />
    <p>Ordens de campos para ordenar os campos de edição</p>
    <p>Os possíveis valores são: header,news,brazil_map,call_to_action,carrossel,featured_news,logos_section,participatory-cards,steps</p>
  </div>
  <div class="card-divider">
    <h2 class="card-title toggle-settings">
      Header
    </h2>
  </div>
  <div class="card-section">
    <input id="field_orders" name="home[header_title]" class="home-fields" />
    <input id="field_orders" name="home[header_subtitle]"  class="home-fields" />
  </div>
  <div class="card-divider">
    <h2 class="card-title toggle-settings">
      Etapas 1
    </h2>
  </div>
  <div class="card-section">
    <input id="field_orders" name="home[steps_subtitle]" class="home-fields" />
    <input id="field_orders" name="home[steps_subtitle]" class="home-fields" />
  </div>
  <div class="card-divider">
    <h2 class="card-title toggle-settings">
      Destaque
    </h2>
  </div>
  <div class="card-section">
    <input id="field_orders" name="home[emphasis_title]" class="home-fields" />
    <input id="field_orders" name="home[emphasis_subtitle]"  class="home-fields"/>
    <input id="field_orders" name="home[emphasis_subtitle]"  class="home-fields"/>
    <input id="field_orders" name="home[emphasis_button_text]"  class="home-fields"/>
    <input id="field_orders" name="home[emphasis_link]"  class="home-fields" />
    <input id="field_orders" name="home[reverse_call_to_action]" type="checkbox"  class="home-fields"/>
  </div>
  <div class="card-divider">
    <h2 class="card-title toggle-settings">
      Participação
    </h2>
  </div>
  <div class="card-section">
    <input id="field_orders" name="home[participation_title]" class="home-fields"/>
    <input id="field_orders" name="home[participation_title]" class="home-fields" />
  </div>
  <div class="card-divider">
    <h2 class="card-title toggle-settings">
      Noticia
    </h2>
  </div>
  <div class="card-section">
    <input id="field_orders" name="home[news_id]" class="home-fields" />
  </div>
</div>
<script>
  $(document).ready(function() {
    $(".settings-section").hide();

    $(".toggle-settings").on("click", function() {
      $(".settings-section").slideToggle();
    });

    // Add an event listener to toggle the visibility of the news_id field
    $(document).on("change", "#home_news", function () {
      var newsIdField = $("#news-id-field");

      // Use jQuery to toggle the visibility of the news_id field
      newsIdField.toggle($(this).is(":checked"));
    });

    $("#home_banner").on("change", function(e) {
      showImagePreview(e.target.files[0], $(".banner-container"));
    });

    function showImagePreview(file, container) {
      var reader = new FileReader();
      reader.onload = function(e) {
        console.log(e.target);
        container.html('<img class="banner-image" src="' + e.target.result + '" alt="Imagem"/>');
      };
      reader.readAsDataURL(file);
    }

    function showImagePreviews(files, container) {
      container.html("");
      for (var i = 0; i < files.length; i++) {
        showImagePreview(files[i], container);
      }
    }

    // Função para exibir e armazenar imagens no campo de entrada de arquivo oculto
    function showAndStoreImages(files, container) {
      container.html(""); // Limpa o contêiner antes de adicionar novas imagens

      var uploadedImagesInput = $("#uploaded-images-input");
      var existingImages = uploadedImagesInput.data("existing-images") || [];

      for (var i = 0; i < files.length; i++) {
        var reader = new FileReader();
        reader.onload = function(e) {
          container.append('<div class="image-preview"><img src="' + e.target.result + '" alt="Imagem"/><button class="remove-image">Remover</button></div>');
        };
        reader.readAsDataURL(files[i]);

        existingImages.push(null); // Adiciona uma entrada nula para imagens recém-adicionadas
      }

      // Atualiza os dados do campo de entrada de arquivo oculto
      uploadedImagesInput.val("");
      uploadedImagesInput.data("existing-images", existingImages);
    }

    // Adiciona um evento de clique para remover imagens
    $(document).on("click", ".remove-image", function() {
      var index = $(this).parent().index();
      var uploadedImagesInput = $("#uploaded-images-input");
      var existingImages = uploadedImagesInput.data("existing-images");

      if (index < existingImages.length) {
        existingImages.splice(index, 1); // Remove a entrada correspondente
        uploadedImagesInput.data("existing-images", existingImages);
      }

      $(this).parent().remove();
    });

    // Adiciona um evento de envio do formulário para atualizar o campo de entrada de arquivo
    $("form").on("submit", function() {
      updateUploadedImagesInput();
    });

    // Função para atualizar o campo de entrada de arquivo com as imagens existentes
    function updateUploadedImagesInput() {
      var uploadedImagesInput = $("#uploaded-images-input");
      var existingImages = uploadedImagesInput.data("existing-images") || [];

      // Atualiza o valor do campo de entrada de arquivo com as imagens existentes
      uploadedImagesInput.val(existingImages.filter(Boolean).join(","));
    }
  });
</script>
<style>
  .banner-container,
  .supporters-container,
  .organizers-container{
    margin: 5px;
  }

  .form h3{
    margin: 1rem;
  }


  .home-fields {
  width: 100%;
  padding: 0.875rem;
  border: 1px solid #eee1ee;
  border-radius: 0.25rem;
  }
</style>
