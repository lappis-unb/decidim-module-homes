<div class="br-container-lg menu-container-space">
  <% @home.try(:field_orders)&.each do |field| %>
    <% begin %>
      <% if field == 'brazil_map' %>
        <%= render partial: 'brazil_map', locals: {
        has_map: @home.meetings_map,
        main_app: main_app,
        current_participatory_space: current_participatory_space
      } %>
      <% elsif field == 'logos_section' %>
        <%= render partial: 'logos_section', locals: {
        organizers: @organizers,
        supporters: @supporters
      } %>
      <% else %>
        <%= render partial: "#{field}" %>
      <% end %>
      <% rescue ActionView::MissingTemplate %>
    <% end %>
  <% end %>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    let iframes = document.getElementsByClassName('home__video-iframe');

    if (iframes){
      for (let i = 0; i < iframes.length; i++) {
        let iframe = iframes[i];
        let video_url = iframe.getAttribute('video_url');
        if (video_url){
          iframe.src = getYoutubeUrl(video_url);
        }
      }
    }
    function getYoutubeUrl(url) {
        const youtubeRegex = /(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([\w-]{11})(?:\S+)?/;
        const match = url.match(youtubeRegex);
        if (match && match[1]) {
        return `https://www.youtube.com/embed/${match[1]}`;
        }
        return null;
    }
  });
</script>
